"use strict";(self.webpackChunkstrapi_project=self.webpackChunkstrapi_project||[]).push([[2114],{12114:(p,P,s)=>{s.d(P,{ProtectedListPage:()=>ts});var _=s(92132),r=s(21272),d=s(34508),n=s(21270),i=s(57842),C=s(43242),T=s(44370),h=s(19106),D=s(55794),E=s(43121),R=s(69564),A=s(44494),U=s(32559),W=s(79318),N=s(67479),I=s(70768),K=s(96586),V=s(83314),a=s(8769),S=s(31127),J=s(72702),X=s(31708),G=s(39423),Y=s(60256),Z=s(88761),$=s(54894),b=s(17703),F=s(57494),k=s(46794),z=s(34216),Ds=s(15126),Ms=s(63299),Os=s(67014),Ps=s(59080),Cs=s(79275),Ts=s(14718),hs=s(82437),Rs=s(61535),As=s(5790),gs=s(12083),ms=s(35223),Ls=s(5409),vs=s(74930),Bs=s(2600),cs=s(48940),Us=s(41286),Ws=s(56336),Is=s(13426),Ks=s(84624),xs=s(77965),js=s(54257),fs=s(71210),us=s(51187),ys=s(39404),ps=s(58692),Ns=s(501),Ss=s(57646),$s=s(23120),Fs=s(44414),zs=s(25962),Hs=s(14664),Qs=s(42588),Vs=s(90325),Js=s(62785),Xs=s(87443),Gs=s(41032),Ys=s(22957),Zs=s(93179),bs=s(73055),ks=s(15747),ws=s(85306),qs=s(26509),s_=s(32058),__=s(81185),t_=s(82261),o_=s(55151),a_=s(79077);const w=({id:t,name:O,description:l,usersCount:m,icons:L,rowIndex:x,canUpdate:v})=>{const{formatMessage:B}=(0,$.A)(),[,g]=L,j=B({id:"Roles.RoleRow.user-count",defaultMessage:"{number, plural, =0 {#  user} one {#  user} other {# users}}"},{number:m});return(0,_.jsxs)(d.Tr,{"aria-rowindex":x,...v?(0,a.onRowClick)({fn:g.onClick}):{},children:[(0,_.jsx)(n.Td,{maxWidth:(0,a.pxToRem)(130),children:(0,_.jsx)(i.o,{ellipsis:!0,textColor:"neutral800",children:O})}),(0,_.jsx)(n.Td,{maxWidth:(0,a.pxToRem)(250),children:(0,_.jsx)(i.o,{ellipsis:!0,textColor:"neutral800",children:l})}),(0,_.jsx)(n.Td,{children:(0,_.jsx)(i.o,{textColor:"neutral800",children:j})}),(0,_.jsx)(n.Td,{children:(0,_.jsx)(C.s,{justifyContent:"flex-end",...a.stopPropagation,children:L.map((e,c)=>e?(0,_.jsx)(T.a,{paddingLeft:c===0?0:1,children:(0,_.jsx)(h.K,{onClick:e.onClick,label:e.label,borderWidth:0,icon:e.icon})},e.label):null)})})]},t)},q=()=>{const{formatMessage:t}=(0,$.A)();(0,a.useFocusWhenNavigate)();const O=(0,F.j)(z.s),{formatAPIError:l}=(0,a.useAPIErrorHandler)(),m=(0,a.useNotification)(),[L,x]=r.useState(!1),[{query:v}]=(0,a.useQueryParams)(),{isLoading:B,allowedActions:{canCreate:g,canDelete:j,canRead:e,canUpdate:c}}=(0,a.useRBAC)(O.settings?.roles),{roles:H,refetch:os}=(0,k.u)({filters:v?._q?{name:{$containsi:v._q}}:void 0},{refetchOnMountOrArgChange:!0,skip:B||!e}),{push:f}=(0,b.W6)(),[{showModalConfirmButtonLoading:as,roleToDelete:ns},u]=r.useReducer(_s,ss),{post:Es}=(0,a.getFetchClient)(),ls=async()=>{try{u({type:"ON_REMOVE_ROLES"}),await Es("/admin/roles/batch-delete",{ids:[ns]}),await os(),u({type:"RESET_DATA_TO_DELETE"})}catch(o){o instanceof Y.pe&&m({type:"warning",message:l(o)})}y()},Q=()=>f("/settings/roles/new"),y=()=>x(o=>!o),is=o=>M=>{M.preventDefault(),M.stopPropagation(),o.usersCount?m({type:"info",message:{id:"Roles.ListPage.notification.delete-not-allowed"}}):(u({type:"SET_ROLE_TO_DELETE",id:o.id}),y())},es=o=>M=>{M.preventDefault(),M.stopPropagation(),f(`/settings/roles/duplicate/${o.id}`)},ds=H.length+1,rs=6;return B?(0,_.jsx)(D.g,{children:(0,_.jsx)(a.LoadingIndicatorPage,{})}):(0,_.jsxs)(D.g,{children:[(0,_.jsx)(a.SettingsPageTitle,{name:"Roles"}),(0,_.jsx)(E.Q,{primaryAction:g?(0,_.jsx)(R.$,{onClick:Q,startIcon:(0,_.jsx)(S.A,{}),size:"S",children:t({id:"Settings.roles.list.button.add",defaultMessage:"Add new role"})}):null,title:t({id:"global.roles",defaultMessage:"roles"}),subtitle:t({id:"Settings.roles.list.description",defaultMessage:"List of roles"}),as:"h2"}),e&&(0,_.jsx)(A.B,{startActions:(0,_.jsx)(a.SearchURLQuery,{label:t({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:t({id:"global.roles",defaultMessage:"roles"})})})}),e&&(0,_.jsx)(U.s,{children:(0,_.jsxs)(W.X,{colCount:rs,rowCount:ds,footer:g?(0,_.jsx)(N.S,{onClick:Q,icon:(0,_.jsx)(S.A,{}),children:t({id:"Settings.roles.list.button.add",defaultMessage:"Add new role"})}):null,children:[(0,_.jsx)(I.d,{children:(0,_.jsxs)(d.Tr,{"aria-rowindex":1,children:[(0,_.jsx)(n.Th,{children:(0,_.jsx)(i.o,{variant:"sigma",textColor:"neutral600",children:t({id:"global.name",defaultMessage:"Name"})})}),(0,_.jsx)(n.Th,{children:(0,_.jsx)(i.o,{variant:"sigma",textColor:"neutral600",children:t({id:"global.description",defaultMessage:"Description"})})}),(0,_.jsx)(n.Th,{children:(0,_.jsx)(i.o,{variant:"sigma",textColor:"neutral600",children:t({id:"global.users",defaultMessage:"Users"})})}),(0,_.jsx)(n.Th,{children:(0,_.jsx)(K.s,{children:t({id:"global.actions",defaultMessage:"Actions"})})})]})}),(0,_.jsx)(V.N,{children:H?.map((o,M)=>(0,_.jsx)(w,{id:o.id,name:o.name,description:o.description,usersCount:o.usersCount,icons:[g&&{onClick:es(o),label:t({id:"app.utils.duplicate",defaultMessage:"Duplicate"}),icon:(0,_.jsx)(J.A,{})},c&&{onClick:()=>f(`/settings/roles/${o.id}`),label:t({id:"app.utils.edit",defaultMessage:"Edit"}),icon:(0,_.jsx)(X.A,{})},j&&{onClick:is(o),label:t({id:"global.delete",defaultMessage:"Delete"}),icon:(0,_.jsx)(G.A,{})}].filter(Boolean),rowIndex:M+2,canUpdate:c},o.id))})]})}),(0,_.jsx)(a.ConfirmDialog,{isOpen:L,onConfirm:ls,isConfirmButtonLoading:as,onToggleDialog:y})]})},ss={roleToDelete:null,showModalConfirmButtonLoading:!1,shouldRefetchData:!1},_s=(t,O)=>(0,Z.default)(t,l=>{switch(O.type){case"ON_REMOVE_ROLES":{l.showModalConfirmButtonLoading=!0;break}case"ON_REMOVE_ROLES_SUCCEEDED":{l.shouldRefetchData=!0,l.roleToDelete=null;break}case"RESET_DATA_TO_DELETE":{l.shouldRefetchData=!1,l.roleToDelete=null,l.showModalConfirmButtonLoading=!1;break}case"SET_ROLE_TO_DELETE":{l.roleToDelete=O.id;break}default:return l}}),ts=()=>{const t=(0,F.j)(z.s);return(0,_.jsx)(a.CheckPagePermissions,{permissions:t.settings?.roles.main,children:(0,_.jsx)(q,{})})}},46794:(p,P,s)=>{s.d(P,{u:()=>i});var _=s(21272),r=s(8769),d=s(54894),n=s(57494);const i=(C={},T)=>{const{locale:h}=(0,d.A)(),D=(0,r.useCollator)(h,{sensitivity:"base"}),{data:E,error:R,isError:A,isLoading:U,refetch:W}=(0,n.z)(C,T);return{roles:_.useMemo(()=>[...E??[]].sort((I,K)=>D.compare(I.name,K.name)),[E,D]),error:R,isError:A,isLoading:U,refetch:W}}},67479:(p,P,s)=>{s.d(P,{S:()=>D});var _=s(92132),r=s(63891),d=s(44370),n=s(24122),i=s(43242),C=s(57842);const T=(0,r.default)(d.a)`
  height: ${24/16}rem;
  width: ${24/16}rem;
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;

  svg {
    height: ${10/16}rem;
    width: ${10/16}rem;
  }

  svg path {
    fill: ${({theme:E})=>E.colors.primary600};
  }
`,h=(0,r.default)(d.a)`
  border-radius: 0 0 ${({theme:E})=>E.borderRadius} ${({theme:E})=>E.borderRadius};
  display: block;
  width: 100%;
  border: none;
`,D=({children:E,icon:R,...A})=>(0,_.jsxs)("div",{children:[(0,_.jsx)(n.c,{}),(0,_.jsx)(h,{as:"button",background:"primary100",padding:5,...A,children:(0,_.jsxs)(i.s,{children:[(0,_.jsx)(T,{"aria-hidden":!0,background:"primary200",children:R}),(0,_.jsx)(d.a,{paddingLeft:3,children:(0,_.jsx)(C.o,{variant:"pi",fontWeight:"bold",textColor:"primary600",children:E})})]})})]})}}]);
