"use strict";(self.webpackChunkstrapi_project=self.webpackChunkstrapi_project||[]).push([[7907],{67907:(y,c,t)=>{t.d(c,{ProtectedListView:()=>Et});var s=t(92132),E=t(21272),h=t(55794),B=t(43121),d=t(93744),M=t(32559),_=t(8769),r=t(31127),a=t(5409),P=t(54894),e=t(17703),W=t(57494),f=t(84895),I=t(99831),K=t(22185),j=t(15126),$=t(63299),V=t(67014),z=t(59080),H=t(79275),G=t(14718),x=t(82437),J=t(61535),Q=t(5790),Y=t(12083),Z=t(35223),n=t(74930),i=t(2600),T=t(48940),O=t(41286),A=t(56336),D=t(13426),l=t(84624),v=t(77965),m=t(54257),u=t(71210),X=t(51187),w=t(39404),b=t(58692),q=t(501),tt=t(57646),o=t(23120),st=t(44414),S=t(25962),Tt=t(14664),Ot=t(42588),At=t(90325),mt=t(62785),ct=t(87443),gt=t(41032),Ct=t(22957),It=t(93179),vt=t(73055),Lt=t(15747),Rt=t(85306),Ut=t(26509),ht=t(32058),Bt=t(81185),Wt=t(82261);const _t=[{name:"name",key:"name",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.name",defaultMessage:"Name"},sortable:!0}},{name:"description",key:"description",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.description",defaultMessage:"Description"},sortable:!1}},{name:"createdAt",key:"createdAt",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.createdAt",defaultMessage:"Created at"},sortable:!1}},{name:"lastUsedAt",key:"lastUsedAt",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.lastUsedAt",defaultMessage:"Last used"},sortable:!1}}],it=()=>{(0,_.useFocusWhenNavigate)();const{formatMessage:g}=(0,P.A)(),L=(0,_.useNotification)(),dt=(0,W.j)(C=>C.admin_app.permissions.settings?.["api-tokens"]),{allowedActions:{canCreate:k,canDelete:rt,canUpdate:lt,canRead:R}}=(0,_.useRBAC)(dt),{push:at}=(0,e.W6)(),{trackUsage:p}=(0,_.useTracking)(),{startSection:et}=(0,_.useGuidedTour)(),{_unstableFormatAPIError:N}=(0,_.useAPIErrorHandler)();E.useEffect(()=>{et("apiTokens")},[et]),E.useEffect(()=>{at({search:a.stringify({sort:"name:ASC"},{encode:!1})})},[at]);const Pt=_t.map(C=>({...C,metadatas:{...C.metadatas,label:g(C.metadatas.label)}}));(0,W.b)(()=>{p("willAccessTokenList",{tokenType:I.A})});const{data:U=[],isLoading:nt,error:F}=(0,f.u)(void 0,{skip:!R});E.useEffect(()=>{F&&L({type:"warning",message:N(F)})},[F,N,L]),E.useEffect(()=>{p("didAccessTokenList",{number:U.length,tokenType:I.A})},[U,p]);const[Dt]=(0,f.a)(),Mt=async C=>{try{const ot=await Dt(C);if("error"in ot){L({type:"warning",message:N(ot.error)});return}p("didDeleteToken")}catch{L({type:"warning",message:{id:"notification.error",defaultMessage:"Something went wrong"}})}};return(0,s.jsxs)(h.g,{"aria-busy":nt,children:[(0,s.jsx)(_.SettingsPageTitle,{name:"API Tokens"}),(0,s.jsx)(B.Q,{title:g({id:"Settings.apiTokens.title",defaultMessage:"API Tokens"}),subtitle:g({id:"Settings.apiTokens.description",defaultMessage:"List of generated tokens to consume the API"}),primaryAction:k&&(0,s.jsx)(d.z,{"data-testid":"create-api-token-button",startIcon:(0,s.jsx)(r.A,{}),size:"S",onClick:()=>p("willAddTokenFromList",{tokenType:I.A}),to:"/settings/api-tokens/create",children:g({id:"Settings.apiTokens.create",defaultMessage:"Create new API Token"})})}),(0,s.jsxs)(M.s,{children:[!R&&(0,s.jsx)(_.NoPermissions,{}),R&&U.length>0&&(0,s.jsx)(K.T,{permissions:{canRead:R,canDelete:rt,canUpdate:lt},headers:Pt,contentType:"api-tokens",isLoading:nt,onConfirmDelete:Mt,tokens:U,tokenType:I.A}),R&&k&&U.length===0&&(0,s.jsx)(_.NoContent,{content:{id:"Settings.apiTokens.addFirstToken",defaultMessage:"Add your first API Token"},action:(0,s.jsx)(d.z,{variant:"secondary",startIcon:(0,s.jsx)(r.A,{}),to:"/settings/api-tokens/create",children:g({id:"Settings.apiTokens.addNewToken",defaultMessage:"Add new API Token"})})}),R&&!k&&U.length===0&&(0,s.jsx)(_.NoContent,{content:{id:"Settings.apiTokens.emptyStateLayout",defaultMessage:"You don\u2019t have any content yet..."}})]})]})},Et=()=>{const g=(0,W.j)(L=>L.admin_app.permissions.settings?.["api-tokens"].main);return(0,s.jsx)(_.CheckPagePermissions,{permissions:g,children:(0,s.jsx)(it,{})})}},22185:(y,c,t)=>{t.d(c,{T:()=>z});var s=t(92132),E=t(21272),h=t(83314),B=t(34508),d=t(21270),M=t(57842),_=t(43242),r=t(44370),a=t(19106),P=t(41171),e=t(8769),W=t(39423),f=t(8046),I=t(31708),K=t(54894),j=t(17703),$=t(71389),V=t(63891);const z=({permissions:n,headers:i=[],contentType:T,isLoading:O=!1,tokens:A=[],onConfirmDelete:D,tokenType:l})=>{const{canDelete:v,canUpdate:m,canRead:u}=n;return(0,s.jsx)(e.DynamicTable,{headers:i,contentType:T,rows:A,withBulkActions:v||m||u,isLoading:O,onConfirmDelete:D,children:(0,s.jsx)(H,{tokenType:l,permissions:n,onConfirmDelete:D})})},H=({tokenType:n,permissions:i,rows:T=[],withBulkActions:O,onConfirmDelete:A})=>{const{canDelete:D,canUpdate:l,canRead:v}=i,[{query:m}]=(0,e.useQueryParams)(),{formatMessage:u}=(0,K.A)(),[,X]=m&&m.sort?m.sort.split(":"):[void 0,"ASC"],{push:w,location:{pathname:b}}=(0,j.W6)(),{trackUsage:q}=(0,e.useTracking)(),tt=[...T].sort((o,st)=>{const S=o.name.localeCompare(st.name);return X==="DESC"?-S:S});return(0,s.jsx)(h.N,{children:tt.map(o=>(0,s.jsxs)(B.Tr,{...(0,e.onRowClick)({fn(){q("willEditTokenFromList",{tokenType:n}),w(`${b}/${o.id}`)},condition:l}),children:[(0,s.jsx)(d.Td,{maxWidth:(0,e.pxToRem)(250),children:(0,s.jsx)(M.o,{textColor:"neutral800",fontWeight:"bold",ellipsis:!0,children:o.name})}),(0,s.jsx)(d.Td,{maxWidth:(0,e.pxToRem)(250),children:(0,s.jsx)(M.o,{textColor:"neutral800",ellipsis:!0,children:o.description})}),(0,s.jsx)(d.Td,{children:(0,s.jsx)(M.o,{textColor:"neutral800",children:(0,s.jsx)(e.RelativeTime,{timestamp:new Date(o.createdAt)})})}),(0,s.jsx)(d.Td,{children:o.lastUsedAt&&(0,s.jsx)(M.o,{textColor:"neutral800",children:(0,s.jsx)(e.RelativeTime,{timestamp:new Date(o.lastUsedAt),customIntervals:[{unit:"hours",threshold:1,text:u({id:"Settings.apiTokens.lastHour",defaultMessage:"last hour"})}]})})}),O&&(0,s.jsx)(d.Td,{children:(0,s.jsxs)(_.s,{justifyContent:"end",children:[l&&(0,s.jsx)(Z,{tokenName:o.name,tokenId:o.id}),!l&&v&&(0,s.jsx)(Y,{tokenName:o.name,tokenId:o.id}),D&&(0,s.jsx)(Q,{tokenName:o.name,onClickDelete:()=>A?.(o.id),tokenType:n})]})})]},o.id))})},G={edit:{id:"app.component.table.edit",defaultMessage:"Edit {target}"},read:{id:"app.component.table.read",defaultMessage:"Read {target}"}},x=({tokenName:n,tokenId:i,buttonType:T="edit",children:O})=>{const{formatMessage:A}=(0,K.A)(),{location:{pathname:D}}=(0,j.W6)();return(0,s.jsx)(J,{forwardedAs:$.NavLink,to:`${D}/${i}`,title:A(G[T],{target:n}),children:O})},J=(0,V.default)(P.N)`
  svg {
    path {
      fill: ${({theme:n})=>n.colors.neutral500};
    }
  }

  &:hover,
  &:focus {
    svg {
      path {
        fill: ${({theme:n})=>n.colors.neutral800};
      }
    }
  }
`,Q=({tokenName:n,onClickDelete:i,tokenType:T})=>{const{formatMessage:O}=(0,K.A)(),{trackUsage:A}=(0,e.useTracking)(),[D,l]=E.useState(!1),v=()=>{l(!1),A("willDeleteToken",{tokenType:T}),i()};return(0,s.jsxs)(r.a,{paddingLeft:1,onClick:m=>m.stopPropagation(),children:[(0,s.jsx)(a.K,{onClick:()=>{l(!0)},label:O({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${n}`}),name:"delete",borderWidth:0,icon:(0,s.jsx)(W.A,{})}),(0,s.jsx)(e.ConfirmDialog,{onToggleDialog:()=>l(!1),onConfirm:v,isOpen:D})]})},Y=({tokenName:n,tokenId:i})=>(0,s.jsx)(x,{tokenName:n,tokenId:i,buttonType:"read",children:(0,s.jsx)(f.A,{})}),Z=({tokenName:n,tokenId:i})=>(0,s.jsx)(x,{tokenName:n,tokenId:i,children:(0,s.jsx)(I.A,{width:12})})},84895:(y,c,t)=>{t.d(c,{a:()=>M,b:()=>B,c:()=>d,d:()=>_,u:()=>h});var s=t(57494);const E=s.n.injectEndpoints({endpoints:r=>({getAPITokens:r.query({query:()=>"/admin/api-tokens",transformResponse:a=>a.data,providesTags:(a,P)=>[...a?.map(({id:e})=>({type:"ApiToken",id:e}))??[],{type:"ApiToken",id:"LIST"}]}),getAPIToken:r.query({query:a=>`/admin/api-tokens/${a}`,transformResponse:a=>a.data,providesTags:(a,P,e)=>[{type:"ApiToken",id:e}]}),createAPIToken:r.mutation({query:a=>({url:"/admin/api-tokens",method:"POST",data:a}),transformResponse:a=>a.data,invalidatesTags:[{type:"ApiToken",id:"LIST"}]}),deleteAPIToken:r.mutation({query:a=>({url:`/admin/api-tokens/${a}`,method:"DELETE"}),transformResponse:a=>a.data,invalidatesTags:(a,P,e)=>[{type:"ApiToken",id:e}]}),updateAPIToken:r.mutation({query:({id:a,...P})=>({url:`/admin/api-tokens/${a}`,method:"PUT",data:P}),transformResponse:a=>a.data,invalidatesTags:(a,P,{id:e})=>[{type:"ApiToken",id:e}]})}),overrideExisting:!1}),{useGetAPITokensQuery:h,useGetAPITokenQuery:B,useCreateAPITokenMutation:d,useDeleteAPITokenMutation:M,useUpdateAPITokenMutation:_}=E},99831:(y,c,t)=>{t.d(c,{A:()=>s,T:()=>E});const s="api-token",E="transfer-token"}}]);
