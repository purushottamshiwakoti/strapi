"use strict";(self.webpackChunkstrapi_project=self.webpackChunkstrapi_project||[]).push([[2072],{62482:(b,A,s)=>{s.d(A,{F:()=>m});var t=s(92132),i=s(21272),E=s(44370),P=s(69564),D=s(8769),l=s(94013),o=s(54894);const m=({displayedFilters:r})=>{const[M,g]=i.useState(!1),{formatMessage:x}=(0,o.A)(),h=i.useRef(null),L=()=>{g(f=>!f)};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(E.a,{paddingTop:1,paddingBottom:1,children:[(0,t.jsx)(P.$,{variant:"tertiary",ref:h,startIcon:(0,t.jsx)(l.A,{}),onClick:L,size:"S",children:x({id:"app.utils.filters",defaultMessage:"Filters"})}),M&&(0,t.jsx)(D.FilterPopoverURLQuery,{displayedFilters:r,isVisible:M,onToggle:L,source:h})]}),(0,t.jsx)(D.FilterListURLQuery,{filtersSchema:r})]})}},62072:(b,A,s)=>{s.d(A,{ProtectedListPage:()=>fs,e:()=>os});var t=s(92132),i=s(21272),E=s(69564),P=s(50642),D=s(6479),l=s(53900),o=s(43242),m=s(44370),r=s(57842),M=s(57564),g=s(68065),x=s(32161),h=s(83314),L=s(34508),f=s(21270),F=s(72182),u=s(19106),T=s(55794),N=s(43121),G=s(44494),Z=s(32559),e=s(8769),p=s(5409),$=s(54894),ss=s(17703),O=s(57494),es=s(62482),U=s(2570),ds=s(31708),_s=s(39423),Es=s(32372),ms=s(714),Ms=s(61535),k=s(12083),is=s(40245),as=s(34216),us=s(15126),Ts=s(63299),Us=s(67014),Bs=s(59080),Is=s(79275),Rs=s(14718),xs=s(82437),ps=s(5790),js=s(35223),ys=s(74930),Ks=s(2600),Ws=s(48940),Ss=s(41286),Fs=s(56336),Ns=s(13426),$s=s(84624),zs=s(77965),Vs=s(54257),Hs=s(71210),Qs=s(51187),Js=s(39404),Ys=s(58692),Xs=s(501),bs=s(57646),Gs=s(23120),Zs=s(44414),ks=s(25962),ws=s(14664),qs=s(42588),st=s(90325),tt=s(62785),et=s(87443),at=s(41032),nt=s(22957),it=s(93179),rt=s(73055),ot=s(15747),lt=s(85306),dt=s(26509),_t=s(32058),Et=s(81185),mt=s(82261),Mt=s(46794),ct=s(55151),Pt=s(79077);const cs=({onClick:a})=>{const{formatMessage:d}=(0,$.A)();return(0,t.jsx)(E.$,{onClick:a,startIcon:(0,t.jsx)(U.A,{}),size:"S",children:d({id:"Settings.permissions.users.create",defaultMessage:"Invite new user"})})},Ps=({onToggle:a})=>{const[d,K]=i.useState("create"),[V,H]=i.useState(""),{formatMessage:v}=(0,$.A)(),B=(0,e.useNotification)(),{lockApp:Q,unlockApp:j}=(0,e.useOverlayBlocker)(),{_unstableFormatAPIError:J,_unstableFormatValidationErrors:W}=(0,e.useAPIErrorHandler)(),n=(0,O.p)(Ds,async()=>(await s.e(9971).then(s.bind(s,79971))).ROLE_LAYOUT,{combine(_,y){return[..._,...y]},defaultValue:[]}),z=(0,O.p)(rs,async()=>(await s.e(9971).then(s.bind(s,79971))).FORM_INITIAL_VALUES,{combine(_,y){return{..._,...y}},defaultValue:rs}),I=(0,O.p)(is.M,async()=>(await s.e(4441).then(s.bind(s,64441))).MagicLinkEE),[Y]=(0,O.H)(),S=v({id:"Settings.permissions.users.create",defaultMessage:"Invite new user"}),w=async(_,{setErrors:y})=>{Q();const C=await Y({..._,roles:_.roles??[]});"data"in C?C.data.registrationToken?(H(C.data.registrationToken),ts()):B({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}):(B({type:"warning",message:J(C.error)}),(0,O.x)(C.error)&&C.error.name==="ValidationError"&&y(W(C.error))),j()},ts=()=>{c?K(c):a()},{buttonSubmitLabel:q,isDisabled:X,next:c}=hs[d];return I?(0,t.jsxs)(P.k,{onClose:a,labelledBy:"title",children:[(0,t.jsx)(D.r,{children:(0,t.jsx)(Es.B,{label:S,children:(0,t.jsx)(ms.m,{isCurrent:!0,children:S})})}),(0,t.jsx)(Ms.Formik,{enableReinitialize:!0,initialValues:z??{},onSubmit:w,validationSchema:gs,validateOnChange:!1,children:({errors:_,handleChange:y,values:C,isSubmitting:ls})=>(0,t.jsxs)(e.Form,{children:[(0,t.jsx)(l.c,{children:(0,t.jsxs)(o.s,{direction:"column",alignItems:"stretch",gap:6,children:[d!=="create"&&(0,t.jsx)(I,{registrationToken:V}),(0,t.jsxs)(m.a,{children:[(0,t.jsx)(r.o,{variant:"beta",as:"h2",children:v({id:"app.components.Users.ModalCreateBody.block-title.details",defaultMessage:"User details"})}),(0,t.jsx)(m.a,{paddingTop:4,children:(0,t.jsx)(o.s,{direction:"column",alignItems:"stretch",gap:1,children:(0,t.jsx)(M.x,{gap:5,children:Os.map(ns=>ns.map(R=>(0,t.jsx)(g.E,{...R.size,children:(0,t.jsx)(e.GenericInput,{...R,disabled:X,error:_[R.name],onChange:y,value:C[R.name]})},R.name)))})})})]}),(0,t.jsxs)(m.a,{children:[(0,t.jsx)(r.o,{variant:"beta",as:"h2",children:v({id:"global.roles",defaultMessage:"User's role"})}),(0,t.jsx)(m.a,{paddingTop:4,children:(0,t.jsxs)(M.x,{gap:5,children:[(0,t.jsx)(g.E,{col:6,xs:12,children:(0,t.jsx)(is.S,{disabled:X,error:_.roles,onChange:y,value:C.roles??[]})}),n.map(ns=>ns.map(R=>(0,t.jsx)(g.E,{...R.size,children:(0,t.jsx)(e.GenericInput,{...R,disabled:X,onChange:y,value:C[R.name]})},R.name)))]})})]})]})}),(0,t.jsx)(x.j,{startActions:(0,t.jsx)(E.$,{variant:"tertiary",onClick:a,type:"button",children:v({id:"app.components.Button.cancel",defaultMessage:"Cancel"})}),endActions:d==="create"?(0,t.jsx)(E.$,{type:"submit",loading:ls,children:v(q)}):(0,t.jsx)(E.$,{type:"button",loading:ls,onClick:a,children:v(q)})})]})})]}):null},rs={firstname:"",lastname:"",email:"",roles:[]},Ds=[],Os=[[{intlLabel:{id:"Auth.form.firstname.label",defaultMessage:"First name"},name:"firstname",placeholder:{id:"Auth.form.firstname.placeholder",defaultMessage:"e.g. Kai"},type:"text",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.lastname.label",defaultMessage:"Last name"},name:"lastname",placeholder:{id:"Auth.form.lastname.placeholder",defaultMessage:"e.g. Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"Auth.form.email.label",defaultMessage:"Email"},name:"email",placeholder:{id:"Auth.form.email.placeholder",defaultMessage:"e.g. kai.doe@strapi.io"},type:"email",size:{col:6,xs:12},required:!0}]],gs=k.object().shape({firstname:k.string().trim().required(e.translatedErrors.required),lastname:k.string(),email:k.string().email(e.translatedErrors.email).required(e.translatedErrors.required),roles:k.array().min(1,e.translatedErrors.required).required(e.translatedErrors.required)}),hs={create:{buttonSubmitLabel:{id:"app.containers.Users.ModalForm.footer.button-success",defaultMessage:"Invite user"},isDisabled:!1,next:"magic-link"},"magic-link":{buttonSubmitLabel:{id:"global.finish",defaultMessage:"Finish"},isDisabled:!0,next:null}},As=({canDelete:a,headers:d=[],entriesToDelete:K=[],onClickDelete:V,onSelectRow:H,withMainAction:v,withBulkActions:B,rows:Q=[]})=>{const{push:j,location:{pathname:J}}=(0,ss.W6)(),{formatMessage:W}=(0,$.A)();return(0,t.jsx)(h.N,{children:Q.map(n=>{const z=K.findIndex(I=>I===n.id)!==-1;return(0,t.jsxs)(L.Tr,{...(0,e.onRowClick)({fn:()=>j(`${J}/${n.id}`),condition:B}),children:[v&&(0,t.jsx)(f.Td,{...e.stopPropagation,children:(0,t.jsx)(F.J,{"aria-label":W({id:"app.component.table.select.one-entry",defaultMessage:"Select {target}"},{target:(0,as.g)(n?.firstname??"",n.lastname)}),checked:z,onChange:()=>{H&&H({name:n.id,value:!z})}})}),d.map(({key:I,cellFormatter:Y,name:S,...w})=>(0,t.jsx)(f.Td,{children:typeof Y=="function"?Y(n,{key:I,name:S,formatMessage:W,...w}):(0,t.jsx)(r.o,{textColor:"neutral800",children:n[S]||"-"})},I)),B&&(0,t.jsx)(f.Td,{children:(0,t.jsxs)(o.s,{justifyContent:"end",children:[(0,t.jsx)(u.K,{onClick:()=>j(`${J}/${n.id}`),label:W({id:"app.component.table.edit",defaultMessage:"Edit {target}"},{target:(0,as.g)(n.firstname??"",n.lastname)}),noBorder:!0,icon:(0,t.jsx)(ds.A,{})}),a&&(0,t.jsx)(m.a,{paddingLeft:1,...e.stopPropagation,children:(0,t.jsx)(u.K,{onClick:()=>{V&&V(n.id)},label:W({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:(0,as.g)(n.firstname??"",n.lastname)}),noBorder:!0,icon:(0,t.jsx)(_s.A,{})})})]})})]},n.id)})})},os=()=>{const{_unstableFormatAPIError:a}=(0,e.useAPIErrorHandler)(),[d,K]=i.useState(!1),V=(0,O.j)(c=>c.admin_app.permissions),{allowedActions:{canCreate:H,canDelete:v,canRead:B}}=(0,e.useRBAC)(V.settings?.users),Q=(0,e.useNotification)(),{formatMessage:j}=(0,$.A)(),{search:J}=(0,ss.zy)();(0,e.useFocusWhenNavigate)();const{data:W,isError:n,isLoading:z}=(0,O.k)(p.parse(J,{ignoreQueryPrefix:!0}),{skip:!B}),{pagination:I,users:Y}=W??{},S=(0,O.p)(cs,async()=>(await s.e(2552).then(s.bind(s,72552))).CreateActionEE),w=vs.map(c=>({...c,metadatas:{...c.metadatas,label:j(c.metadatas.label)}})),ts=j({id:"global.users",defaultMessage:"Users"}),q=()=>{K(c=>!c)},[X]=(0,O.J)();return S?(0,t.jsxs)(T.g,{"aria-busy":z,children:[(0,t.jsx)(e.SettingsPageTitle,{name:"Users"}),(0,t.jsx)(N.Q,{primaryAction:H&&(0,t.jsx)(S,{onClick:q}),title:ts,subtitle:j({id:"Settings.permissions.users.listview.header.subtitle",defaultMessage:"All the users who have access to the Strapi admin panel"})}),B&&(0,t.jsx)(G.B,{startActions:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.SearchURLQuery,{label:j({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:ts})}),(0,t.jsx)(es.F,{displayedFilters:Cs})]})}),(0,t.jsxs)(Z.s,{children:[!B&&(0,t.jsx)(e.NoPermissions,{}),n&&(0,t.jsx)("div",{children:"TODO: An error occurred"}),B&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.DynamicTable,{contentType:"Users",isLoading:z,onConfirmDeleteAll:async c=>{const _=await X({ids:c});"error"in _&&Q({type:"warning",message:a(_.error)})},onConfirmDelete:async c=>{const _=await X({ids:[c]});"error"in _&&Q({type:"warning",message:a(_.error)})},headers:w,rows:Y,withBulkActions:!0,withMainAction:v,children:(0,t.jsx)(As,{canDelete:v})}),I&&(0,t.jsx)(m.a,{paddingTop:4,children:(0,t.jsxs)(o.s,{alignItems:"flex-end",justifyContent:"space-between",children:[(0,t.jsx)(e.PageSizeURLQuery,{}),(0,t.jsx)(e.PaginationURLQuery,{pagination:I})]})})]})]}),d&&(0,t.jsx)(Ps,{onToggle:q})]}):null},vs=[{name:"firstname",key:"firstname",metadatas:{label:{id:"Settings.permissions.users.firstname",defaultMessage:"Firstname"},sortable:!0}},{name:"lastname",key:"lastname",metadatas:{label:{id:"Settings.permissions.users.lastname",defaultMessage:"Lastname"},sortable:!0}},{key:"email",name:"email",metadatas:{label:{id:"Settings.permissions.users.email",defaultMessage:"Email"},sortable:!0}},{key:"roles",name:"roles",metadatas:{label:{id:"Settings.permissions.users.roles",defaultMessage:"Roles"},sortable:!1},cellFormatter({roles:a},{formatMessage:d}){return(0,t.jsx)(r.o,{textColor:"neutral800",children:a.map(K=>d({id:`Settings.permissions.users.${K.code}`,defaultMessage:K.name})).join(`,
`)})}},{key:"username",name:"username",metadatas:{label:{id:"Settings.permissions.users.username",defaultMessage:"Username"},sortable:!0}},{key:"isActive",name:"isActive",metadatas:{label:{id:"Settings.permissions.users.user-status",defaultMessage:"User status"},sortable:!1},cellFormatter({isActive:a},{formatMessage:d}){return(0,t.jsxs)(o.s,{children:[(0,t.jsx)(e.Status,{variant:a?"success":"danger"}),(0,t.jsx)(r.o,{textColor:"neutral800",children:d({id:a?"Settings.permissions.users.active":"Settings.permissions.users.inactive",defaultMessage:a?"Active":"Inactive"})})]})}}],Cs=[{name:"firstname",metadatas:{label:"Firstname"},fieldSchema:{type:"string"}},{name:"lastname",metadatas:{label:"Lastname"},fieldSchema:{type:"string"}},{name:"email",metadatas:{label:"Email"},fieldSchema:{type:"email"}},{name:"username",metadatas:{label:"Username"},fieldSchema:{type:"string"}},{name:"isActive",metadatas:{label:"Active user"},fieldSchema:{type:"boolean"}}],Ls=()=>{const a=(0,O.p)(os,async()=>(await s.e(9880).then(s.bind(s,19880))).UserListPageEE);return a?(0,t.jsx)(a,{}):null},fs=()=>{const a=(0,O.j)(d=>d.admin_app.permissions.settings?.users.main);return(0,t.jsx)(e.CheckPagePermissions,{permissions:a,children:(0,t.jsx)(Ls,{})})}},40245:(b,A,s)=>{s.d(A,{M:()=>x,S:()=>h,a:()=>g});var t=s(92132),i=s(54894),E=s(57494),P=s(19106),D=s(5391),l=s(8769),o=s(72702),m=s(16034),r=s(63891),M=s(46794);const g=({children:u,target:T})=>{const N=(0,l.useNotification)(),{formatMessage:G}=(0,i.A)(),{copy:Z}=(0,l.useClipboard)(),e=G({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),p=async()=>{await Z(T)&&N({type:"info",message:{id:"notification.link-copied"}})};return(0,t.jsx)(l.ContentBox,{endAction:(0,t.jsx)(P.K,{label:e,noBorder:!0,icon:(0,t.jsx)(o.A,{}),onClick:p}),title:T,titleEllipsis:!0,subtitle:u,icon:(0,t.jsx)("span",{style:{fontSize:32},children:"\u2709\uFE0F"}),iconBackground:"neutral100"})},x=({registrationToken:u})=>{const{formatMessage:T}=(0,i.A)(),N=`${window.location.origin}${(0,E.K)()}/auth/register?registrationToken=${u}`;return(0,t.jsx)(g,{target:N,children:T({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"})})},h=({disabled:u,error:T,onChange:N,value:G})=>{const{isLoading:Z,roles:e}=(0,M.u)(),{formatMessage:p}=(0,i.A)(),$=T?p({id:T,defaultMessage:T}):"",ss=p({id:"app.components.Users.ModalCreateBody.block-title.roles",defaultMessage:"User's roles"}),O=p({id:"app.components.Users.ModalCreateBody.block-title.roles.description",defaultMessage:"A user can have one or several roles"}),es=p({id:"app.components.Select.placeholder",defaultMessage:"Select"});return(0,t.jsx)(D.KF,{id:"roles",disabled:u,error:$,hint:O,label:ss,name:"roles",onChange:U=>{N({target:{name:"roles",value:U}})},placeholder:es,startIcon:Z?(0,t.jsx)(F,{}):void 0,value:G.map(U=>U.toString()),withTags:!0,required:!0,children:e.map(U=>(0,t.jsx)(D.fe,{value:U.id.toString(),children:p({id:`global.${U.code}`,defaultMessage:U.name})},U.id))})},L=(0,r.keyframes)`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(359deg);
  }
`,f=r.default.div`
  animation: ${L} 2s infinite linear;
`,F=()=>(0,t.jsx)(f,{children:(0,t.jsx)(m.A,{})})},46794:(b,A,s)=>{s.d(A,{u:()=>D});var t=s(21272),i=s(8769),E=s(54894),P=s(57494);const D=(l={},o)=>{const{locale:m}=(0,E.A)(),r=(0,i.useCollator)(m,{sensitivity:"base"}),{data:M,error:g,isError:x,isLoading:h,refetch:L}=(0,P.z)(l,o);return{roles:t.useMemo(()=>[...M??[]].sort((F,u)=>r.compare(F.name,u.name)),[M,r]),error:g,isError:x,isLoading:h,refetch:L}}},32372:(b,A,s)=>{s.d(A,{B:()=>r});var t=s(92132),i=s(21272),E=s(63891),P=s(44370),D=s(57842);const l=()=>(0,t.jsx)(P.a,{"aria-hidden":!0,paddingLeft:1,paddingRight:1,children:(0,t.jsx)(D.o,{variant:"pi",textColor:"neutral500",children:"/"})});l.displayName="Divider";var o=s(43242);const m=(0,E.default)(o.s)`
  // CrumbLinks do have padding-x, because they need to have a
  // interaction effect, which mis-aligns the breadcrumbs on the left.
  // This normalizes the behavior by moving the first item to left by
  // the same amount it has inner padding
  :first-child {
    margin-left: ${({theme:M})=>`calc(-1*${M.spaces[2]})`};
  }
`,r=({label:M,children:g,...x})=>{const h=i.Children.toArray(g);return(0,t.jsx)(P.a,{"aria-label":M,...x,children:(0,t.jsx)(m,{as:"ol",children:i.Children.map(h,(L,f)=>{const F=h.length>1&&f+1<h.length;return(0,t.jsxs)(o.s,{inline:!0,as:"li",children:[L,F&&(0,t.jsx)(l,{})]})})})})};r.displayName="Breadcrumbs"},714:(b,A,s)=>{s.d(A,{m:()=>P});var t=s(92132),i=s(44370),E=s(57842);const P=({children:D,isCurrent:l=!1,...o})=>(0,t.jsx)(i.a,{paddingLeft:2,paddingRight:2,paddingTop:1,paddingBottom:1,children:(0,t.jsx)(E.o,{variant:"pi",textColor:"neutral800",fontWeight:l?"bold":"normal","aria-current":l,...o,children:D})});P.displayName="Crumb"}}]);
